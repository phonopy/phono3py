
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Direct solution of linearized phonon Boltzmann equation &#8212; Phono3py v.3.0.3</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=7d3540eb"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'direct-solution';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Solution of the Wigner transport equation" href="wigner-solution.html" />
    <link rel="prev" title="Auxiliary tools" href="auxiliary-tools.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Phono3py v.3.0.3</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="interfaces.html">Interfaces to calculators (VASP, QE, CRYSTAL, Abinit, TURBOMOLE)</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="vasp.html">VASP &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="qe.html">Quantum ESPRESSO (pw) &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crystal.html">CRYSTAL &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="turbomole.html">TURBOMOLE &amp; phono3py calculation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command-options.html">Command options / Setting tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-output-files.html">Input / Output files</a></li>
<li class="toctree-l1"><a class="reference internal" href="hdf5_howto.html">How to read the results stored in hdf5 files</a></li>
<li class="toctree-l1"><a class="reference internal" href="auxiliary-tools.html">Auxiliary tools</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Direct solution of linearized phonon Boltzmann equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="wigner-solution.html">Solution of the Wigner transport equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="workload-distribution.html">Workload distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="cutoff-pair.html">Force constants calculation with cutoff pair-distance</a></li>
<li class="toctree-l1"><a class="reference internal" href="external-tools.html">External tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="phono3py-api.html">Phono3py API</a></li>
<li class="toctree-l1"><a class="reference internal" href="phono3py-load.html">phono3py-load command</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite phono3py</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/direct-solution.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Direct solution of linearized phonon Boltzmann equation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use">How to use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-usage">Memory usage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#work-load-distribution">Work load distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-collision-matrix">Distribution of collision matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-phonon-phonon-interaction-strengths">Distribution of phonon-phonon interaction strengths</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cutoff-parameter-of-pseudo-inversion">Cutoff parameter of pseudo inversion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagonalization-solver-interfaces">Diagonalization solver interfaces</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#openblas-or-mkl-linked-scipy-and-numpy">OpenBLAS or MKL linked scipy and numpy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#openblas-or-mkl-via-lapacke">OpenBLAS or MKL via LAPACKE</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-choice-for-diagonalization">Solver choice for diagonalization</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="direct-solution-of-linearized-phonon-boltzmann-equation">
<span id="direct-solution"></span><h1>Direct solution of linearized phonon Boltzmann equation<a class="headerlink" href="#direct-solution-of-linearized-phonon-boltzmann-equation" title="Link to this heading">#</a></h1>
<p>This page explains how to use the direct solution of LBTE by
<a class="reference external" href="https://doi.org/10.1103/PhysRevLett.110.265506">L. Chaput, Phys. Rev. Lett. 110, 265506 (2013)</a>
(<a class="reference internal" href="citation.html#citation-direct-solution-lbte"><span class="std std-ref">citation</span></a>).</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-use" id="id1">How to use</a></p></li>
<li><p><a class="reference internal" href="#memory-usage" id="id2">Memory usage</a></p></li>
<li><p><a class="reference internal" href="#work-load-distribution" id="id3">Work load distribution</a></p>
<ul>
<li><p><a class="reference internal" href="#distribution-of-collision-matrix" id="id4">Distribution of collision matrix</a></p></li>
<li><p><a class="reference internal" href="#distribution-of-phonon-phonon-interaction-strengths" id="id5">Distribution of phonon-phonon interaction strengths</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cutoff-parameter-of-pseudo-inversion" id="id6">Cutoff parameter of pseudo inversion</a></p></li>
<li><p><a class="reference internal" href="#diagonalization-solver-interfaces" id="id7">Diagonalization solver interfaces</a></p>
<ul>
<li><p><a class="reference internal" href="#openblas-or-mkl-linked-scipy-and-numpy" id="id8">OpenBLAS or MKL linked scipy and numpy</a></p></li>
<li><p><a class="reference internal" href="#openblas-or-mkl-via-lapacke" id="id9">OpenBLAS or MKL via LAPACKE</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#solver-choice-for-diagonalization" id="id10">Solver choice for diagonalization</a></p></li>
</ul>
</nav>
<section id="how-to-use">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">How to use</a><a class="headerlink" href="#how-to-use" title="Link to this heading">#</a></h2>
<p>As written in the following sections, this calculation requires large memory
space. When running multiple temperature points, simply the memory space needed
is multiplied by the number of the temperature points. Therefore it is normally
recommended to specify <a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts option</span></a>. An example to run with
the direct solution of LBTE for <code class="docutils literal notranslate"><span class="pre">example/Si-PBEsol</span></code> is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">11</span><span class="w"> </span>--lbte<span class="w"> </span>--ts<span class="w"> </span><span class="m">300</span>
...

<span class="o">===================</span><span class="w"> </span>End<span class="w"> </span>of<span class="w"> </span>collection<span class="w"> </span>of<span class="w"> </span><span class="nv">collisions</span><span class="w"> </span><span class="o">===================</span>
-<span class="w"> </span>Averaging<span class="w"> </span>collision<span class="w"> </span>matrix<span class="w"> </span>elements<span class="w"> </span>by<span class="w"> </span>phonon<span class="w"> </span>degeneracy<span class="w"> </span><span class="o">[</span><span class="m">0</span>.036s<span class="o">]</span>
-<span class="w"> </span>Making<span class="w"> </span>collision<span class="w"> </span>matrix<span class="w"> </span>symmetric<span class="w"> </span><span class="o">(</span>built-in<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">0</span>.001s<span class="o">]</span>
-----------<span class="w"> </span>Thermal<span class="w"> </span>conductivity<span class="w"> </span><span class="o">(</span>W/m-k<span class="o">)</span><span class="w"> </span>with<span class="w"> </span>tetrahedron<span class="w"> </span>method<span class="w"> </span>-----------
Diagonalizing<span class="w"> </span>by<span class="w"> </span>lapacke<span class="w"> </span>dsyev...<span class="w"> </span><span class="o">[</span><span class="m">0</span>.141s<span class="o">]</span>
Calculating<span class="w"> </span>pseudo-inv<span class="w"> </span>with<span class="w"> </span><span class="nv">cutoff</span><span class="o">=</span><span class="m">1</span>.0e-08<span class="w"> </span><span class="o">(</span>np.dot<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">0</span>.001s<span class="o">]</span>
<span class="c1">#  T(K)        xx         yy         zz         yz         xz         xy</span>
<span class="w">  </span><span class="m">300</span>.0<span class="w">     </span><span class="m">113</span>.140<span class="w">    </span><span class="m">113</span>.140<span class="w">    </span><span class="m">113</span>.140<span class="w">      </span><span class="m">0</span>.000<span class="w">      </span><span class="m">0</span>.000<span class="w">     </span>-0.000
<span class="w">  </span><span class="o">(</span>RTA<span class="o">)</span><span class="w">     </span><span class="m">108</span>.982<span class="w">    </span><span class="m">108</span>.982<span class="w">    </span><span class="m">108</span>.982<span class="w">      </span><span class="m">0</span>.000<span class="w">      </span><span class="m">0</span>.000<span class="w">     </span>-0.000
----------------------------------------------------------------------------

Thermal<span class="w"> </span>conductivity<span class="w"> </span>and<span class="w"> </span>related<span class="w"> </span>properties<span class="w"> </span>were<span class="w"> </span>written<span class="w"> </span>into
<span class="s2">&quot;kappa-m111111.hdf5&quot;</span>.
Eigenvalues<span class="w"> </span>of<span class="w"> </span>collision<span class="w"> </span>matrix<span class="w"> </span>were<span class="w"> </span>written<span class="w"> </span>into<span class="w"> </span><span class="s2">&quot;coleigs-m111111.hdf5&quot;</span>
...
</pre></div>
</div>
</section>
<section id="memory-usage">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Memory usage</a><a class="headerlink" href="#memory-usage" title="Link to this heading">#</a></h2>
<p>The direct solution of LBTE needs diagonalization of a large collision matrix,
which requires large memory space. This is the largest limitation of using this
method. The memory size needed for one collision matrix at a temperature point
is
<span class="math notranslate nohighlight">\((\text{number of
irreducible grid points} \times \text{number of bands} \times 3)^2\)</span>
for the symmetrized collision matrix.</p>
<!---
   and $(\text{number of grid
   points} \times \text{number of bands})^2$ for the non-symmetrized
   collision matrix.
--->
<p>These collision matrices contain real values and are supposed to be 64bit float
symmetric matrices. During the diagonalization of each collision matrix with
LAPACK <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> solver, around 1.2 times more memory space is consumed in total.</p>
<p>When phono3py runs with <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a> together with <code class="docutils literal notranslate"><span class="pre">--lbte</span></code>
option, estimated memory space needed for storing collision matrix is presented.
An example for <code class="docutils literal notranslate"><span class="pre">example/Si-PBEsol</span></code> is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span>--lbte<span class="w"> </span>--wgp
...

Memory<span class="w"> </span>requirements:
-<span class="w"> </span>Piece<span class="w"> </span>of<span class="w"> </span>collision<span class="w"> </span>matrix<span class="w"> </span>at<span class="w"> </span>each<span class="w"> </span>grid<span class="w"> </span>point,<span class="w"> </span>temp<span class="w"> </span>and<span class="w"> </span>sigma:<span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>Gb
-<span class="w"> </span>Full<span class="w"> </span>collision<span class="w"> </span>matrix<span class="w"> </span>at<span class="w"> </span>each<span class="w"> </span>temp<span class="w"> </span>and<span class="w"> </span>sigma:<span class="w"> </span><span class="m">7</span>.15<span class="w"> </span>Gb
-<span class="w"> </span>Phonons:<span class="w"> </span><span class="m">0</span>.04<span class="w"> </span>Gb
-<span class="w"> </span>Grid<span class="w"> </span>point<span class="w"> </span>information:<span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>Gb
-<span class="w"> </span>Phonon<span class="w"> </span>properties:<span class="w"> </span><span class="m">0</span>.14<span class="w"> </span>Gb

...
</pre></div>
</div>
<p>With <a class="reference internal" href="command-options.html#stp-option"><span class="std std-ref">–stp option</span></a>, estimated memory space needed for ph-ph
interaction strengths is shown such as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span>--lbte<span class="w"> </span>--stp
</pre></div>
</div>
</section>
<section id="work-load-distribution">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Work load distribution</a><a class="headerlink" href="#work-load-distribution" title="Link to this heading">#</a></h2>
<p>The other difficulty compared with RTA is the workload distribution. Currently
there are two ways to distribute the calculation: (1) Collision matrix is
divided and the pieces are distributed into computing nodes. (2) Ph-ph
interaction strengths at grid points are distributed into computing nodes. These
two can not be mixed, so one of them has to be chosen. In either case, the
distribution is done simply running a set of phono3py calculations over grid
points and optionally band indices. The data computed on each computing node are
stored in an hdf5 file. Increasing the calculation size, e.g., larger mesh
numbers or larger number of atoms in the primitive cell, large files are
created.</p>
<section id="distribution-of-collision-matrix">
<span id="distribution-colmat"></span><h3><a class="toc-backref" href="#id4" role="doc-backlink">Distribution of collision matrix</a><a class="headerlink" href="#distribution-of-collision-matrix" title="Link to this heading">#</a></h3>
<p>A full collision matrix is divided into pieces at grid points of irreducible
part of Brillouin zone. Each piece is calculated independently from the other
pieces. After finishing the calculations of these pieces, the full collision
matrix is diagonzalized to obtain the thermal conductivity.</p>
<p>File size of Each piece of the collision matrix can be large. Therefore it is
recommended to use <a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts option</span></a> to limit the number of
temperature points, e.g., <code class="docutils literal notranslate"><span class="pre">--ts</span> <span class="pre">&quot;100</span> <span class="pre">200</span> <span class="pre">300</span> <span class="pre">400</span> <span class="pre">500&quot;</span></code>, depending on the memory
size installed on each computing node. To write them into files,
<code class="docutils literal notranslate"><span class="pre">--write-collision</span></code> option must be specified, and to read them from files,
<code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> option is used. These are similarly used as
<a class="reference internal" href="command-options.html#write-gamma-option"><span class="std std-ref">–write-gamma</span></a> and
<a class="reference internal" href="command-options.html#read-gamma-option"><span class="std std-ref">–read-gamma</span></a> options for RTA calculation as shown in
<a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>. <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> option collects the pieces and
make one full collision matrix, then starts to diagonalize it. This option
requires one argument to specify an index to read the collision matrix at one
temperature point, e.g., the collision matrix at 200K is read with
<code class="docutils literal notranslate"><span class="pre">--read-collision</span> <span class="pre">1</span></code> for the (pieces of) collision matrices created with
<code class="docutils literal notranslate"><span class="pre">--ts</span> <span class="pre">&quot;100</span> <span class="pre">200</span> <span class="pre">300</span> <span class="pre">400</span> <span class="pre">500&quot;</span></code> (corresponding to 0, 1, 2, 3, 4). The temperature
(e.g. 200K) is also read from the file, so it is unnecessary to specify
<a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts option</span></a> when reading.</p>
<p>The summary of the procedure is as follows:</p>
<ol class="arabic simple">
<li><p>Running at each grid point with <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option and saving the piece of the collision matrix
to an hdf5 file with <code class="docutils literal notranslate"><span class="pre">--write-collision</span></code> option. It is probably OK to
calculate and store the pieces of the collision matrices at multiple
temperatures though it depends on memory size of the computer node. This
calculation has to be done at all irreducible grid points.</p></li>
<li><p>Collecting and creating all necessary pieces of the collision matrix with
<code class="docutils literal notranslate"><span class="pre">--read-collision=num</span></code> (<code class="docutils literal notranslate"><span class="pre">num</span></code>: index of temperature). By this one full
collision matrix at the selected temperature is created and then
diagonalized. An option <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">num</span></code> may be used together with <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code>
to distinguish the file names of the results at different temperatures.</p></li>
</ol>
<p>Examples of command options are shown below using <code class="docutils literal notranslate"><span class="pre">Si-PBE</span></code> example. Irreducible
grid point indices are obtained by <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">19</span><span class="w"> </span>--lbte<span class="w"> </span>--wgp
</pre></div>
</div>
<p>and the information is given in <code class="docutils literal notranslate"><span class="pre">ir_grid_points.yaml</span></code>. For distribution of
collision matrix calculation (see also <a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">19</span><span class="w"> </span>--lbte<span class="w"> </span>--ts<span class="w"> </span><span class="m">300</span><span class="w"> </span>--write-collision<span class="w"> </span>--gp<span class="o">=</span><span class="s2">&quot;grid_point_numbers...&quot;</span>
</pre></div>
</div>
<p>To collect distributed pieces of the collision matrix:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">19</span><span class="w"> </span>--lbte<span class="w"> </span>--read-collision<span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">--read-collision</span> <span class="pre">0</span></code> indicates to read the first result in the list of
temperatures by <code class="docutils literal notranslate"><span class="pre">--ts</span></code> option, i.e., 300K in this case.</p>
</section>
<section id="distribution-of-phonon-phonon-interaction-strengths">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Distribution of phonon-phonon interaction strengths</a><a class="headerlink" href="#distribution-of-phonon-phonon-interaction-strengths" title="Link to this heading">#</a></h3>
<p>The distribution of pieces of collision matrix is straightforward and is
recommended to use if the number of temperature points is small. However
increasing data file size, network communication becomes to require long time to
send the files from a master node to computation nodes. In this case, the
distribution over ph-ph interaction strengths can be another choice. Since,
without using <a class="reference internal" href="command-options.html#full-pp-option"><span class="std std-ref">–full-pp option</span></a>, the tetrahedron method
or smearing approach with <a class="reference internal" href="command-options.html#sigma-cutoff-option"><span class="std std-ref">–sigma-cutoff option</span></a>
results in the sparse ph-ph interaction strength data array, i.e., most of the
elements are zero, the data size can be reduced by only storing non-zero
elements. Not like the collision matrix, the ph-ph interaction strengths in
phono3py are independent from temperature though it is not the case if the force
constants provided are temperature dependent. Once stored, they are used to
create the collision matrices at temperatures. Using <code class="docutils literal notranslate"><span class="pre">--write-pp</span></code> and
<code class="docutils literal notranslate"><span class="pre">--read-pp</span></code>, they are written into and read from hdf5 files at grid points.</p>
<p>It is also recommended to use <a class="reference internal" href="command-options.html#write-phonon-option"><span class="std std-ref">–write-phonon option</span></a>
and <a class="reference internal" href="command-options.html#read-phonon-option"><span class="std std-ref">–read-phonon option</span></a> to use identical phonon
eigenvectors among the distributed nodes.</p>
<p>The summary of the procedure is as follows:</p>
<ol class="arabic simple">
<li><p>Running at each grid point with <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option and storing the ph-ph interaction strengths
to an hdf5 file with <code class="docutils literal notranslate"><span class="pre">--write-pp</span></code> option. This calculation has to be done at
all irreducible grid points.</p></li>
<li><p>Running with <code class="docutils literal notranslate"><span class="pre">--read-pp</span></code> option and without <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option. By this one full collision matrix at the
selected temperature is created and then diagonalized. An option <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">num</span></code> may
be used together with <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> to distinguish the file names of the
results at different temperatures.</p></li>
</ol>
<p>Examples of command options are shown below using <code class="docutils literal notranslate"><span class="pre">Si-PBE</span></code> example. Irreducible
grid point indices are obtained by <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="s2">&quot;19 19 19&quot;</span><span class="w"> </span>--lbte<span class="w"> </span>--wgp
</pre></div>
</div>
<p>and the grid point information is provided in <code class="docutils literal notranslate"><span class="pre">ir_grid_points.yaml</span></code>. All phonons
on mesh grid points are saved by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="s2">&quot;19 19 19&quot;</span><span class="w"> </span>--write-phonon
</pre></div>
</div>
<p>For distribution of ph-ph interaction strength calculation (see also
<a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="s2">&quot;19 19 19&quot;</span><span class="w"> </span>--lbte<span class="w"> </span>--ts<span class="w"> </span><span class="m">300</span><span class="w"> </span>--write-pp<span class="w"> </span>--gp<span class="w"> </span><span class="s2">&quot;grid_point_numbers...&quot;</span><span class="w"> </span>--read-phonon
</pre></div>
</div>
<p>Here one temperature has to be specified but any one of temperatures is OK since
ph-ph interaction strength computed here is assumed to be temperature
independent. Then the computed ph-ph interaction strengths are read and used to
compute collision matrix and lattice thermal conductivity at a temperature by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-load<span class="w"> </span>--mesh<span class="w"> </span><span class="s2">&quot;19 19 19&quot;</span><span class="w"> </span>--lbte<span class="w"> </span>--ts<span class="w"> </span><span class="m">300</span><span class="w"> </span>--read-pp<span class="w"> </span>--read-phonon
</pre></div>
</div>
<p>This last command is repeated at different temperatures to obtain the properties
at multiple temperatures.</p>
</section>
</section>
<section id="cutoff-parameter-of-pseudo-inversion">
<span id="diagonzalization-solver"></span><h2><a class="toc-backref" href="#id6" role="doc-backlink">Cutoff parameter of pseudo inversion</a><a class="headerlink" href="#cutoff-parameter-of-pseudo-inversion" title="Link to this heading">#</a></h2>
<p>To achieve a pseudo inversion, a cutoff parameter is used to find null space,
i.e., to select the nearly zero eigenvalues. The default cutoff value is <code class="docutils literal notranslate"><span class="pre">1e-8</span></code>,
and this hopefully works in many cases. But if a collision matrix is numerically
not very accurate, we may have to carefully choose the value by <code class="docutils literal notranslate"><span class="pre">--pinv-cutoff</span></code>
option. It is safer to plot the absolute values of eigenvalues in log scale to
see if there is clear gap between non-zero eigenvalue and nearly-zero
eigenvalues. After running the direct solution of LBTE, <code class="docutils literal notranslate"><span class="pre">coleigs-mxxx.hdf5</span></code> is
created. This contains the eigenvalues of the collision matrix (either
symmetrized or non-symmetrized). The eigenvalues are plotted using
<code class="docutils literal notranslate"><span class="pre">phono3py-coleigplot</span></code> in the phono3py package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phono3py-coleigplot<span class="w"> </span>coleigs-mxxx.hdf5
</pre></div>
</div>
<p>It is assumed that only one set of eigenvalues at a temperature point is
contained.</p>
<figure class="align-default" id="coleigplot">
<a class="reference internal image-reference" href="_images/Si-coleigplot.png"><img alt="_images/Si-coleigplot.png" src="_images/Si-coleigplot.png" style="width: 50%;" />
</a>
<figcaption>
<p><span class="caption-text">Eigenvalues are plotted in log scale (Si-PBEsol exmaple with
15x15x15 mesh). The number in x-axis is just the index where each
eigenvalue is stored. Normally the eigenvalues are stored ascending
order. The bule points show the positive values, and
the red points show the negative values as positive values
(absolute values) to be able to plot in log scale. In this plot, we
can see the gap between <span class="math notranslate nohighlight">\(10^{-4}\)</span> and <span class="math notranslate nohighlight">\(10^{-16}\)</span>, which
is a good sign. The values whose absolute values are smaller than
<span class="math notranslate nohighlight">\(10^{-8}\)</span> are treated as 0 and those solutions are considered
as null spaces.</span><a class="headerlink" href="#coleigplot" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="diagonalization-solver-interfaces">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Diagonalization solver interfaces</a><a class="headerlink" href="#diagonalization-solver-interfaces" title="Link to this heading">#</a></h2>
<p>Multithreaded BLAS is recommended to use for the calculation of the direct
solution of LBTE because the diagonalization of the collision matrix is
computationally highly demanding. The diagonalization in Phono3py relies on
LAPACK via BLAS library. There are choices of the BLAS libraries. OpenBLAS and
MKL are considered most popular choices. For non-INTEL (or AMD) systems such as
ARM64, MKL can not be used. How to choose the BLAS library in installation via
conda-forge is written <a class="reference internal" href="install.html#install-an-example"><span class="std std-ref">here</span></a>.</p>
<p>Phono3py has two different interfaces to the LAPACK library. One is via scipy
(or numpy), and the other is via LAPACKE as shown below. How to switch between
interfaces is described in the
<a class="reference internal" href="#direct-solution-solver-choice"><span class="std std-ref">next section</span></a>.</p>
<section id="openblas-or-mkl-linked-scipy-and-numpy">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">OpenBLAS or MKL linked scipy and numpy</a><a class="headerlink" href="#openblas-or-mkl-linked-scipy-and-numpy" title="Link to this heading">#</a></h3>
<p>Scipy and numpy have interfaces to LAPACK <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>, and scipy also has the
interface to <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>. OpenBLAS and MKL linked scipy and numpy are provided by
conda-forge.</p>
</section>
<section id="openblas-or-mkl-via-lapacke">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">OpenBLAS or MKL via LAPACKE</a><a class="headerlink" href="#openblas-or-mkl-via-lapacke" title="Link to this heading">#</a></h3>
<p>LAPACK <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> and <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code> can be accessed via LAPACKE in the phono3py’s C
language implementation through the python C-API.</p>
</section>
</section>
<section id="solver-choice-for-diagonalization">
<span id="direct-solution-solver-choice"></span><h2><a class="toc-backref" href="#id10" role="doc-backlink">Solver choice for diagonalization</a><a class="headerlink" href="#solver-choice-for-diagonalization" title="Link to this heading">#</a></h2>
<p>For larger systems, diagonalization of collision matrix takes longest time and
requires large memory space. Phono3py relies on LAPACK for the diagonalization
and so the performance is dependent on the choice of the diagonalization solver.</p>
<p>Using multithreaded BLAS with many-core computing node, computing time may be
well reduced and the calculation can finish in a realistic time. Currently
scipy, numpy and LAPACKE can be used as the LAPACK wrapper in phono3py. Scipy
and numpy distributed by anaconda are MKL linked, therefore MKL multithread BLAS
is used through them. Multithreaded OpenBLAS is installed by conda and can be
used via LAPACKE in phono3py. MKL LAPACK and BLAS are also able to be used via
LAPACKE in phono3py with appropriate setting in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">--pinv-solver=[number]</span></code>, one of the following solver is chosen:</p>
<ol class="arabic simple">
<li><p>Lapacke <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>: Smaller memory consumption than <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>, but slower. This
is the default solver when MKL LAPACKE is integrated or scipy is not
installed.</p></li>
<li><p>Lapacke <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>: Larger memory consumption than <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>, but faster. This is
not considered as stable as <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> but can be significantly faster than
<code class="docutils literal notranslate"><span class="pre">dsyev</span></code> for solving large collision matrix. It is recommended to compare the
result with that by <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> solver using smaller collision matrix (e.g.,
sparser sampling mesh) before starting solving large collision matrix.</p></li>
<li><p>Numpy’s <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code> (<code class="docutils literal notranslate"><span class="pre">linalg.eigh</span></code>). Similar to solver (2), this solver should
be used carefully.</p></li>
<li><p>Scipy’s <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>: This is the default solver when scipy is installed and MKL
LAPACKE is not integrated.</p></li>
<li><p>Scipy’s <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>: Similar to solver (2), this solver should be used
carefully.</p></li>
</ol>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="auxiliary-tools.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Auxiliary tools</p>
      </div>
    </a>
    <a class="right-next"
       href="wigner-solution.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Solution of the Wigner transport equation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use">How to use</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-usage">Memory usage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#work-load-distribution">Work load distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-collision-matrix">Distribution of collision matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-phonon-phonon-interaction-strengths">Distribution of phonon-phonon interaction strengths</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cutoff-parameter-of-pseudo-inversion">Cutoff parameter of pseudo inversion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagonalization-solver-interfaces">Diagonalization solver interfaces</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#openblas-or-mkl-linked-scipy-and-numpy">OpenBLAS or MKL linked scipy and numpy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#openblas-or-mkl-via-lapacke">OpenBLAS or MKL via LAPACKE</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-choice-for-diagonalization">Solver choice for diagonalization</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2015, Atsushi Togo.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>