
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Direct solution of linearized phonon Boltzmann equation &#8212; Phono3py v.2.4.1</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Solution of the Wigner transport equation" href="wigner-solution.html" />
    <link rel="prev" title="Auxiliary tools" href="auxiliary-tools.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Phono3py v.2.4.1</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="workflow.html">
   Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="examples.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="interfaces.html">
   Interfaces to calculators (VASP, QE, CRYSTAL, Abinit, TURBOMOLE)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="vasp.html">
     VASP &amp; phono3py calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="qe.html">
     Quantum ESPRESSO (pw) &amp; phono3py calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="crystal.html">
     CRYSTAL &amp; phono3py calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="turbomole.html">
     TURBOMOLE &amp; phono3py calculation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="command-options.html">
   Command options / Setting tags
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="input-output-files.html">
   Input / Output files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hdf5_howto.html">
   How to read the results stored in hdf5 files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="auxiliary-tools.html">
   Auxiliary tools
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Direct solution of linearized phonon Boltzmann equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wigner-solution.html">
   Solution of the Wigner transport equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="workload-distribution.html">
   Workload distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cutoff-pair.html">
   Force constants calculation with cutoff pair-distance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="external-tools.html">
   External tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="phono3py-api.html">
   Phono3py API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="phono3py-load.html">
   phono3py-load command
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tips.html">
   Tips
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="citation.html">
   How to cite phono3py
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Change Log
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/direct-solution.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-use">
   How to use
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#memory-usage">
   Memory usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#work-load-distribution">
   Work load distribution
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-collision-matrix">
     Distribution of collision matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-phonon-phonon-interaction-strengths">
     Distribution of phonon-phonon interaction strengths
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cutoff-parameter-of-pseudo-inversion">
   Cutoff parameter of pseudo inversion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#diagonalization-solver-interfaces">
   Diagonalization solver interfaces
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#openblas-or-mkl-linked-scipy-and-numpy">
     OpenBLAS or MKL linked scipy and numpy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#openblas-or-mkl-via-lapacke">
     OpenBLAS or MKL via LAPACKE
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solver-choice-for-diagonalization">
   Solver choice for diagonalization
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Direct solution of linearized phonon Boltzmann equation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-use">
   How to use
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#memory-usage">
   Memory usage
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#work-load-distribution">
   Work load distribution
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-collision-matrix">
     Distribution of collision matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-phonon-phonon-interaction-strengths">
     Distribution of phonon-phonon interaction strengths
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cutoff-parameter-of-pseudo-inversion">
   Cutoff parameter of pseudo inversion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#diagonalization-solver-interfaces">
   Diagonalization solver interfaces
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#openblas-or-mkl-linked-scipy-and-numpy">
     OpenBLAS or MKL linked scipy and numpy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#openblas-or-mkl-via-lapacke">
     OpenBLAS or MKL via LAPACKE
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solver-choice-for-diagonalization">
   Solver choice for diagonalization
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="direct-solution-of-linearized-phonon-boltzmann-equation">
<span id="direct-solution"></span><h1>Direct solution of linearized phonon Boltzmann equation<a class="headerlink" href="#direct-solution-of-linearized-phonon-boltzmann-equation" title="Permalink to this headline">#</a></h1>
<p>This page explains how to use the direct solution of LBTE by
<a class="reference external" href="https://doi.org/10.1103/PhysRevLett.110.265506">L. Chaput, Phys. Rev. Lett. 110, 265506 (2013)</a>
(<a class="reference internal" href="citation.html#citation-direct-solution-lbte"><span class="std std-ref">citation</span></a>).</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-use" id="id1">How to use</a></p></li>
<li><p><a class="reference internal" href="#memory-usage" id="id2">Memory usage</a></p></li>
<li><p><a class="reference internal" href="#work-load-distribution" id="id3">Work load distribution</a></p>
<ul>
<li><p><a class="reference internal" href="#distribution-of-collision-matrix" id="id4">Distribution of collision matrix</a></p></li>
<li><p><a class="reference internal" href="#distribution-of-phonon-phonon-interaction-strengths" id="id5">Distribution of phonon-phonon interaction strengths</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cutoff-parameter-of-pseudo-inversion" id="id6">Cutoff parameter of pseudo inversion</a></p></li>
<li><p><a class="reference internal" href="#diagonalization-solver-interfaces" id="id7">Diagonalization solver interfaces</a></p>
<ul>
<li><p><a class="reference internal" href="#openblas-or-mkl-linked-scipy-and-numpy" id="id8">OpenBLAS or MKL linked scipy and numpy</a></p></li>
<li><p><a class="reference internal" href="#openblas-or-mkl-via-lapacke" id="id9">OpenBLAS or MKL via LAPACKE</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#solver-choice-for-diagonalization" id="id10">Solver choice for diagonalization</a></p></li>
</ul>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id1">How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">#</a></h2>
<p>As written in the following sections, this calculation requires large memory
space. When running multiple temperature points, simply the memory space needed
is multiplied by the number of the temperature points. Therefore it is normally
recommended to specify <a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts option</span></a>. An example to run with
the direct solution of LBTE for <code class="docutils literal notranslate"><span class="pre">example/Si-PBEsol</span></code> is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="m">11</span> <span class="m">11</span> <span class="m">11</span> --lbte --ts <span class="m">300</span>
...

<span class="o">===================</span> End of collection of <span class="nv">collisions</span> <span class="o">===================</span>
- Averaging collision matrix elements by phonon degeneracy <span class="o">[</span><span class="m">0</span>.036s<span class="o">]</span>
- Making collision matrix symmetric <span class="o">(</span>built-in<span class="o">)</span> <span class="o">[</span><span class="m">0</span>.001s<span class="o">]</span>
----------- Thermal conductivity <span class="o">(</span>W/m-k<span class="o">)</span> with tetrahedron method -----------
Diagonalizing by lapacke dsyev... <span class="o">[</span><span class="m">0</span>.141s<span class="o">]</span>
Calculating pseudo-inv with <span class="nv">cutoff</span><span class="o">=</span><span class="m">1</span>.0e-08 <span class="o">(</span>np.dot<span class="o">)</span> <span class="o">[</span><span class="m">0</span>.001s<span class="o">]</span>
<span class="c1">#  T(K)        xx         yy         zz         yz         xz         xy</span>
  <span class="m">300</span>.0     <span class="m">113</span>.140    <span class="m">113</span>.140    <span class="m">113</span>.140      <span class="m">0</span>.000      <span class="m">0</span>.000     -0.000
  <span class="o">(</span>RTA<span class="o">)</span>     <span class="m">108</span>.982    <span class="m">108</span>.982    <span class="m">108</span>.982      <span class="m">0</span>.000      <span class="m">0</span>.000     -0.000
----------------------------------------------------------------------------

Thermal conductivity and related properties were written into
<span class="s2">&quot;kappa-m111111.hdf5&quot;</span>.
Eigenvalues of collision matrix were written into <span class="s2">&quot;coleigs-m111111.hdf5&quot;</span>
...
</pre></div>
</div>
</div>
<div class="section" id="memory-usage">
<h2><a class="toc-backref" href="#id2">Memory usage</a><a class="headerlink" href="#memory-usage" title="Permalink to this headline">#</a></h2>
<p>The direct solution of LBTE needs diagonalization of a large collision matrix,
which requires large memory space. This is the largest limitation of using this
method. The memory size needed for one collision matrix at a temperature point
is
<span class="math notranslate nohighlight">\((\text{number of
irreducible grid points} \times \text{number of bands} \times 3)^2\)</span>
for the symmetrized collision matrix.</p>
<!---
   and $(\text{number of grid
   points} \times \text{number of bands})^2$ for the non-symmetrized
   collision matrix.
--->
<p>These collision matrices contain real values and are supposed to be 64bit float
symmetric matrices. During the diagonalization of each collision matrix with
LAPACK <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> solver, around 1.2 times more memory space is consumed in total.</p>
<p>When phono3py runs with <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a> together with <code class="docutils literal notranslate"><span class="pre">--lbte</span></code>
option, estimated memory space needed for storing collision matrix is presented.
An example for <code class="docutils literal notranslate"><span class="pre">example/Si-PBEsol</span></code> is as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="m">40</span> <span class="m">40</span> <span class="m">40</span> --lbte --wgp
...

Memory requirements:
- Piece of collision matrix at each grid point, temp and sigma: <span class="m">0</span>.00 Gb
- Full collision matrix at each temp and sigma: <span class="m">7</span>.15 Gb
- Phonons: <span class="m">0</span>.04 Gb
- Grid point information: <span class="m">0</span>.00 Gb
- Phonon properties: <span class="m">0</span>.14 Gb

...
</pre></div>
</div>
<p>With <a class="reference internal" href="command-options.html#stp-option"><span class="std std-ref">–stp option</span></a>, estimated memory space needed for ph-ph
interaction strengths is shown such as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="m">40</span> <span class="m">40</span> <span class="m">40</span> --lbte --stp
</pre></div>
</div>
</div>
<div class="section" id="work-load-distribution">
<h2><a class="toc-backref" href="#id3">Work load distribution</a><a class="headerlink" href="#work-load-distribution" title="Permalink to this headline">#</a></h2>
<p>The other difficulty compared with RTA is the workload distribution. Currently
there are two ways to distribute the calculation: (1) Collision matrix is
divided and the pieces are distributed into computing nodes. (2) Ph-ph
interaction strengths at grid points are distributed into computing nodes. These
two can not be mixed, so one of them has to be chosen. In either case, the
distribution is done simply running a set of phono3py calculations over grid
points and optionally band indices. The data computed on each computing node are
stored in an hdf5 file. Increasing the calculation size, e.g., larger mesh
numbers or larger number of atoms in the primitive cell, large files are
created.</p>
<div class="section" id="distribution-of-collision-matrix">
<span id="distribution-colmat"></span><h3><a class="toc-backref" href="#id4">Distribution of collision matrix</a><a class="headerlink" href="#distribution-of-collision-matrix" title="Permalink to this headline">#</a></h3>
<p>A full collision matrix is divided into pieces at grid points of irreducible
part of Brillouin zone. Each piece is calculated independently from the other
pieces. After finishing the calculations of these pieces, the full collision
matrix is diagonzalized to obtain the thermal conductivity.</p>
<p>File size of Each piece of the collision matrix can be large. Therefore it is
recommended to use <a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts option</span></a> to limit the number of
temperature points, e.g., <code class="docutils literal notranslate"><span class="pre">--ts</span> <span class="pre">&quot;100</span> <span class="pre">200</span> <span class="pre">300</span> <span class="pre">400</span> <span class="pre">500&quot;</span></code>, depending on the memory
size installed on each computing node. To write them into files,
<code class="docutils literal notranslate"><span class="pre">--write-collision</span></code> option must be specified, and to read them from files,
<code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> option is used. These are similarly used as
<a class="reference internal" href="command-options.html#write-gamma-option"><span class="std std-ref">–write-gamma</span></a> and
<a class="reference internal" href="command-options.html#read-gamma-option"><span class="std std-ref">–read-gamma</span></a> options for RTA calculation as shown in
<a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>. <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> option collects the pieces and
make one full collision matrix, then starts to diagonalize it. This option
requires one argument to specify an index to read the collision matrix at one
temperature point, e.g., the collision matrix at 200K is read with
<code class="docutils literal notranslate"><span class="pre">--read-collision</span> <span class="pre">1</span></code> for the (pieces of) collision matrices created with
<code class="docutils literal notranslate"><span class="pre">--ts</span> <span class="pre">&quot;100</span> <span class="pre">200</span> <span class="pre">300</span> <span class="pre">400</span> <span class="pre">500&quot;</span></code> (corresponding to 0, 1, 2, 3, 4). The temperature
(e.g. 200K) is also read from the file, so it is unnecessary to specify
<a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts option</span></a> when reading.</p>
<p>The summary of the procedure is as follows:</p>
<ol class="arabic simple">
<li><p>Running at each grid point with <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option and saving the piece of the collision matrix
to an hdf5 file with <code class="docutils literal notranslate"><span class="pre">--write-collision</span></code> option. It is probably OK to
calculate and store the pieces of the collision matrices at multiple
temperatures though it depends on memory size of the computer node. This
calculation has to be done at all irreducible grid points.</p></li>
<li><p>Collecting and creating all necessary pieces of the collision matrix with
<code class="docutils literal notranslate"><span class="pre">--read-collision=num</span></code> (<code class="docutils literal notranslate"><span class="pre">num</span></code>: index of temperature). By this one full
collision matrix at the selected temperature is created and then
diagonalized. An option <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">num</span></code> may be used together with <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code>
to distinguish the file names of the results at different temperatures.</p></li>
</ol>
<p>Examples of command options are shown below using <code class="docutils literal notranslate"><span class="pre">Si-PBE</span></code> example. Irreducible
grid point indices are obtained by <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="m">19</span> <span class="m">19</span> <span class="m">19</span> --lbte --wgp
</pre></div>
</div>
<p>and the information is given in <code class="docutils literal notranslate"><span class="pre">ir_grid_points.yaml</span></code>. For distribution of
collision matrix calculation (see also <a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="m">19</span> <span class="m">19</span> <span class="m">19</span> --lbte --ts <span class="m">300</span> --write-collision --gp<span class="o">=</span><span class="s2">&quot;grid_point_numbers...&quot;</span>
</pre></div>
</div>
<p>To collect distributed pieces of the collision matrix:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="m">19</span> <span class="m">19</span> <span class="m">19</span> --lbte --read-collision <span class="m">0</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">--read-collision</span> <span class="pre">0</span></code> indicates to read the first result in the list of
temperatures by <code class="docutils literal notranslate"><span class="pre">--ts</span></code> option, i.e., 300K in this case.</p>
</div>
<div class="section" id="distribution-of-phonon-phonon-interaction-strengths">
<h3><a class="toc-backref" href="#id5">Distribution of phonon-phonon interaction strengths</a><a class="headerlink" href="#distribution-of-phonon-phonon-interaction-strengths" title="Permalink to this headline">#</a></h3>
<p>The distribution of pieces of collision matrix is straightforward and is
recommended to use if the number of temperature points is small. However
increasing data file size, network communication becomes to require long time to
send the files from a master node to computation nodes. In this case, the
distribution over ph-ph interaction strengths can be another choice. Since,
without using <a class="reference internal" href="command-options.html#full-pp-option"><span class="std std-ref">–full-pp option</span></a>, the tetrahedron method
or smearing approach with <a class="reference internal" href="command-options.html#sigma-cutoff-option"><span class="std std-ref">–sigma-cutoff option</span></a>
results in the sparse ph-ph interaction strength data array, i.e., most of the
elements are zero, the data size can be reduced by only storing non-zero
elements. Not like the collision matrix, the ph-ph interaction strengths in
phono3py are independent from temperature though it is not the case if the force
constants provided are temperature dependent. Once stored, they are used to
create the collision matrices at temperatures. Using <code class="docutils literal notranslate"><span class="pre">--write-pp</span></code> and
<code class="docutils literal notranslate"><span class="pre">--read-pp</span></code>, they are written into and read from hdf5 files at grid points.</p>
<p>It is also recommended to use <a class="reference internal" href="command-options.html#write-phonon-option"><span class="std std-ref">–write-phonon option</span></a>
and <a class="reference internal" href="command-options.html#read-phonon-option"><span class="std std-ref">–read-phonon option</span></a> to use identical phonon
eigenvectors among the distributed nodes.</p>
<p>The summary of the procedure is as follows:</p>
<ol class="arabic simple">
<li><p>Running at each grid point with <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option and storing the ph-ph interaction strengths
to an hdf5 file with <code class="docutils literal notranslate"><span class="pre">--write-pp</span></code> option. This calculation has to be done at
all irreducible grid points.</p></li>
<li><p>Running with <code class="docutils literal notranslate"><span class="pre">--read-pp</span></code> option and without <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option. By this one full collision matrix at the
selected temperature is created and then diagonalized. An option <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">num</span></code> may
be used together with <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> to distinguish the file names of the
results at different temperatures.</p></li>
</ol>
<p>Examples of command options are shown below using <code class="docutils literal notranslate"><span class="pre">Si-PBE</span></code> example. Irreducible
grid point indices are obtained by <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="s2">&quot;19 19 19&quot;</span> --lbte --wgp
</pre></div>
</div>
<p>and the grid point information is provided in <code class="docutils literal notranslate"><span class="pre">ir_grid_points.yaml</span></code>. All phonons
on mesh grid points are saved by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="s2">&quot;19 19 19&quot;</span> --write-phonon
</pre></div>
</div>
<p>For distribution of ph-ph interaction strength calculation (see also
<a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="s2">&quot;19 19 19&quot;</span> --lbte --ts <span class="m">300</span> --write-pp --gp <span class="s2">&quot;grid_point_numbers...&quot;</span> --read-phonon
</pre></div>
</div>
<p>Here one temperature has to be specified but any one of temperatures is OK since
ph-ph interaction strength computed here is assumed to be temperature
independent. Then the computed ph-ph interaction strengths are read and used to
compute collision matrix and lattice thermal conductivity at a temperature by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-load --mesh <span class="s2">&quot;19 19 19&quot;</span> --lbte --ts <span class="m">300</span> --read-pp --read-phonon
</pre></div>
</div>
<p>This last command is repeated at different temperatures to obtain the properties
at multiple temperatures.</p>
</div>
</div>
<div class="section" id="cutoff-parameter-of-pseudo-inversion">
<span id="diagonzalization-solver"></span><h2><a class="toc-backref" href="#id6">Cutoff parameter of pseudo inversion</a><a class="headerlink" href="#cutoff-parameter-of-pseudo-inversion" title="Permalink to this headline">#</a></h2>
<p>To achieve a pseudo inversion, a cutoff parameter is used to find null space,
i.e., to select the nearly zero eigenvalues. The default cutoff value is <code class="docutils literal notranslate"><span class="pre">1e-8</span></code>,
and this hopefully works in many cases. But if a collision matrix is numerically
not very accurate, we may have to carefully choose the value by <code class="docutils literal notranslate"><span class="pre">--pinv-cutoff</span></code>
option. It is safer to plot the absolute values of eigenvalues in log scale to
see if there is clear gap between non-zero eigenvalue and nearly-zero
eigenvalues. After running the direct solution of LBTE, <code class="docutils literal notranslate"><span class="pre">coleigs-mxxx.hdf5</span></code> is
created. This contains the eigenvalues of the collision matrix (either
symmetrized or non-symmetrized). The eigenvalues are plotted using
<code class="docutils literal notranslate"><span class="pre">phono3py-coleigplot</span></code> in the phono3py package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% phono3py-coleigplot coleigs-mxxx.hdf5
</pre></div>
</div>
<p>It is assumed that only one set of eigenvalues at a temperature point is
contained.</p>
<div class="figure align-default" id="coleigplot">
<a class="reference internal image-reference" href="_images/Si-coleigplot.png"><img alt="_images/Si-coleigplot.png" src="_images/Si-coleigplot.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-text">Eigenvalues are plotted in log scale (Si-PBEsol exmaple with
15x15x15 mesh). The number in x-axis is just the index where each
eigenvalue is stored. Normally the eigenvalues are stored ascending
order. The bule points show the positive values, and
the red points show the negative values as positive values
(absolute values) to be able to plot in log scale. In this plot, we
can see the gap between <span class="math notranslate nohighlight">\(10^{-4}\)</span> and <span class="math notranslate nohighlight">\(10^{-16}\)</span>, which
is a good sign. The values whose absolute values are smaller than
<span class="math notranslate nohighlight">\(10^{-8}\)</span> are treated as 0 and those solutions are considered
as null spaces.</span><a class="headerlink" href="#coleigplot" title="Permalink to this image">#</a></p>
</div>
</div>
<div class="section" id="diagonalization-solver-interfaces">
<h2><a class="toc-backref" href="#id7">Diagonalization solver interfaces</a><a class="headerlink" href="#diagonalization-solver-interfaces" title="Permalink to this headline">#</a></h2>
<p>Multithreaded BLAS is recommended to use for the calculation of the direct
solution of LBTE because the diagonalization of the collision matrix is
computationally highly demanding. The diagonalization in Phono3py relies on
LAPACK via BLAS library. There are choices of the BLAS libraries. OpenBLAS and
MKL are considered most popular choices. For non-INTEL (or AMD) systems such as
ARM64, MKL can not be used. How to choose the BLAS library in installation via
conda-forge is written <a class="reference internal" href="install.html#install-an-example"><span class="std std-ref">here</span></a>.</p>
<p>Phono3py has two different interfaces to the LAPACK library. One is via scipy
(or numpy), and the other is via LAPACKE as shown below. How to switch between
interfaces is described in the
<a class="reference internal" href="#direct-solution-solver-choice"><span class="std std-ref">next section</span></a>.</p>
<div class="section" id="openblas-or-mkl-linked-scipy-and-numpy">
<h3><a class="toc-backref" href="#id8">OpenBLAS or MKL linked scipy and numpy</a><a class="headerlink" href="#openblas-or-mkl-linked-scipy-and-numpy" title="Permalink to this headline">#</a></h3>
<p>Scipy and numpy have interfaces to LAPACK <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>, and scipy also has the
interface to <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>. OpenBLAS and MKL linked scipy and numpy are provided by
conda-forge.</p>
</div>
<div class="section" id="openblas-or-mkl-via-lapacke">
<h3><a class="toc-backref" href="#id9">OpenBLAS or MKL via LAPACKE</a><a class="headerlink" href="#openblas-or-mkl-via-lapacke" title="Permalink to this headline">#</a></h3>
<p>LAPACK <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> and <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code> can be accessed via LAPACKE in the phono3py’s C
language implementation through the python C-API.</p>
</div>
</div>
<div class="section" id="solver-choice-for-diagonalization">
<span id="direct-solution-solver-choice"></span><h2><a class="toc-backref" href="#id10">Solver choice for diagonalization</a><a class="headerlink" href="#solver-choice-for-diagonalization" title="Permalink to this headline">#</a></h2>
<p>For larger systems, diagonalization of collision matrix takes longest time and
requires large memory space. Phono3py relies on LAPACK for the diagonalization
and so the performance is dependent on the choice of the diagonalization solver.</p>
<p>Using multithreaded BLAS with many-core computing node, computing time may be
well reduced and the calculation can finish in a realistic time. Currently
scipy, numpy and LAPACKE can be used as the LAPACK wrapper in phono3py. Scipy
and numpy distributed by anaconda are MKL linked, therefore MKL multithread BLAS
is used through them. Multithreaded OpenBLAS is installed by conda and can be
used via LAPACKE in phono3py. MKL LAPACK and BLAS are also able to be used via
LAPACKE in phono3py with appropriate setting in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">--pinv-solver=[number]</span></code>, one of the following solver is chosen:</p>
<ol class="arabic simple">
<li><p>Lapacke <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>: Smaller memory consumption than <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>, but slower. This
is the default solver when MKL LAPACKE is integrated or scipy is not
installed.</p></li>
<li><p>Lapacke <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>: Larger memory consumption than <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>, but faster. This is
not considered as stable as <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> but can be significantly faster than
<code class="docutils literal notranslate"><span class="pre">dsyev</span></code> for solving large collision matrix. It is recommended to compare the
result with that by <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> solver using smaller collision matrix (e.g.,
sparser sampling mesh) before starting solving large collision matrix.</p></li>
<li><p>Numpy’s <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code> (<code class="docutils literal notranslate"><span class="pre">linalg.eigh</span></code>). Similar to solver (2), this solver should
be used carefully.</p></li>
<li><p>Scipy’s <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>: This is the default solver when scipy is installed and MKL
LAPACKE is not integrated.</p></li>
<li><p>Scipy’s <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>: Similar to solver (2), this solver should be used
carefully.</p></li>
</ol>
</div>
</div>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="auxiliary-tools.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Auxiliary tools</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="wigner-solution.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Solution of the Wigner transport equation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2015, Atsushi Togo.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>