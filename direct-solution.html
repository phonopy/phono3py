<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Direct solution of linearized phonon Boltzmann equation &#8212; Phono3py v.1.16.0</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="External tools" href="external-tools.html" />
    <link rel="prev" title="Auxiliary tools" href="auxiliary-tools.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Phono3py</a>
        <span class="navbar-text navbar-version pull-left"><b>1.16.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-using-conda">Installation using conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-using-pip">Installation using pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-from-source-code">Installation from source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-on-macos">Installation on macOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#an-example-of-installation-process">An example of installation process</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#multithreading-and-its-controlling-by-c-macro">Multithreading and its controlling by C macro</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#trouble-shooting">Trouble shooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Interfaces to calculators (VASP, pwscf, CRYSTAL, Abinit)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vasp.html">VASP &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pwscf.html">Pwscf &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crystal.html">CRYSTAL &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="interfaces.html#calculator-specific-behaviors">Calculator specific behaviors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command-options.html">Command options / Setting tags</a><ul>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#calculator-interface">Calculator interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#force-constants">Force constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#reciprocal-space-sampling-mesh-and-grid-points-and-band-indices">Reciprocal space sampling mesh and grid points, and band indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#brillouin-zone-integration">Brillouin zone integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#physical-properties">Physical properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#file-i-o">File I/O</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#intermediate-text-files">Intermediate text files</a></li>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#hdf5-files">HDF5 files</a></li>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#simple-text-file">Simple text file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hdf5_howto.html">How to read the results stored in hdf5 files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#how-to-use-hdf5-python-library">How to use HDF5 python library</a></li>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#details-of-kappa-hdf5-file">Details of <code class="docutils literal notranslate"><span class="pre">kappa-*.hdf5</span></code> file</a></li>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#how-to-know-grid-point-number-corresponding-to-grid-address">How to know grid point number corresponding to grid address</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auxiliary-tools.html">Auxiliary tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="auxiliary-tools.html#phono3py-kaccum"><code class="docutils literal notranslate"><span class="pre">phono3py-kaccum</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="auxiliary-tools.html#phono3py-kdeplot"><code class="docutils literal notranslate"><span class="pre">phono3py-kdeplot</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Direct solution of linearized phonon Boltzmann equation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use">How to use</a></li>
<li class="toctree-l2"><a class="reference internal" href="#memory-usage">Memory usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#work-load-distribution">Work load distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cutoff-parameter-of-pseudo-inversion">Cutoff parameter of pseudo inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-of-diagonalization-solvers-with-multithreaded-blas">Installation of diagonalization solvers with multithreaded BLAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solver-choice-for-diagonalization">Solver choice for diagonalization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workload-distribution.html">Workload distribution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="workload-distribution.html#how-to-do-it">How to do it</a></li>
<li class="toctree-l2"><a class="reference internal" href="workload-distribution.html#a-convenient-script">A convenient script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cutoff-pair.html">Crude force constants calculation by cutoff pair-distance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cutoff-pair.html#what-is-cutff-pair-distance-in-phono3py">What is cutff pair-distance in phono3py?</a></li>
<li class="toctree-l2"><a class="reference internal" href="cutoff-pair.html#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="cutoff-pair.html#the-test">The Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="external-tools.html">External tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="external-tools.html#kinetic-collective-model">Kinetic Collective Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips.html#brillouin-zone-summation">Brillouin zone summation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#importance-of-numerical-quality-of-force-constants">Importance of numerical quality of force constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#file-format-compatibility-with-phonopy">File format compatibility with phonopy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite phono3py</a><ul>
<li class="toctree-l2"><a class="reference internal" href="citation.html#citation-of-phono3py">Citation of phono3py</a></li>
<li class="toctree-l2"><a class="reference internal" href="citation.html#citation-of-direct-solution-of-lbte-lbte">Citation of direct solution of LBTE (<code class="docutils literal notranslate"><span class="pre">--lbte</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-22-2018-version-1-14-3">Nov-22-2018: version 1.14.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#june-20-2018-version-1-13-3">June-20-2018: version 1.13.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#may-17-2018-version-1-13-1">May-17-2018: version 1.13.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-16-2018-version-1-12-9">Mar-16-2018: version 1.12.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-1-2018-version-1-12-7">Feb-1-2018: version 1.12.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-22-2017-version-1-12-5">Nov-22-2017: version 1.12.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-17-2017-version-1-12-3">Nov-17-2017: version 1.12.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-18-2017-version-1-11-13">Jun-18-2017: version 1.11.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-31-2017-version-1-11-11">Mar-31-2017: version 1.11.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-9-2017-version-1-11-9">Feb-9-2017: version 1.11.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#dec-14-2016-version-1-11-7">Dec-14-2016: version 1.11.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-27-2016-version-1-11-5">Nov-27-2016: version 1.11.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#apr-24-2016-version-1-10-9">Apr-24-2016: version 1.10.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#apr-16-2016-version-1-10-7">Apr-16-2016: version 1.10.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-15-2016-version-1-10-5">Mar-15-2016: version 1.10.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#oct-10-2015-version-0-9-14">Oct-10-2015: version 0.9.14</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#sep-26-2015-version-0-9-13">Sep-26-2015: version 0.9.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#aug-12-2015-version-0-9-12">Aug-12-2015: version 0.9.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-18-2015-version-0-9-10-1">Jun-18-2015: version 0.9.10.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-17-2015-version-0-9-10">Jun-17-2015: version 0.9.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-7">Changes in version 0.9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-6">Changes in version 0.9.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-5">Changes in version 0.9.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-4">Changes in version 0.9.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-11">Changes in version 0.8.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-10">Changes in version 0.8.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-2">Changes in version 0.8.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-0">Changes in version 0.8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-6">Changes in version 0.7.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-2">Changes in version 0.7.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-1">Changes in version 0.7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-6-0">Changes in version 0.6.0</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Direct solution of linearized phonon Boltzmann equation</a><ul>
<li><a class="reference internal" href="#how-to-use">How to use</a></li>
<li><a class="reference internal" href="#memory-usage">Memory usage</a></li>
<li><a class="reference internal" href="#work-load-distribution">Work load distribution</a><ul>
<li><a class="reference internal" href="#distribution-of-collision-matrix">Distribution of collision matrix</a></li>
<li><a class="reference internal" href="#distribution-of-phonon-phonon-interaction-strengths">Distribution of phonon-phonon interaction strengths</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cutoff-parameter-of-pseudo-inversion">Cutoff parameter of pseudo inversion</a></li>
<li><a class="reference internal" href="#installation-of-diagonalization-solvers-with-multithreaded-blas">Installation of diagonalization solvers with multithreaded BLAS</a><ul>
<li><a class="reference internal" href="#mkl-linked-scipy">MKL linked scipy</a></li>
<li><a class="reference internal" href="#openblas-or-mkl-via-lapacke">OpenBLAS or MKL via LAPACKE</a><ul>
<li><a class="reference internal" href="#openblas">OpenBLAS</a></li>
<li><a class="reference internal" href="#mkl">MKL</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#solver-choice-for-diagonalization">Solver choice for diagonalization</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="auxiliary-tools.html" title="Previous Chapter: Auxiliary tools"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Auxiliary tools</span>
    </a>
  </li>
  <li>
    <a href="external-tools.html" title="Next Chapter: External tools"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">External tools &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="direct-solution-of-linearized-phonon-boltzmann-equation">
<span id="direct-solution"></span><h1>Direct solution of linearized phonon Boltzmann equation<a class="headerlink" href="#direct-solution-of-linearized-phonon-boltzmann-equation" title="Permalink to this headline">¶</a></h1>
<p>This page explains how to use the direct solution of LBTE by
<a class="reference external" href="https://doi.org/10.1103/PhysRevLett.110.265506">L. Chaput, Phys. Rev. Lett. 110, 265506 (2013)</a> (<a class="reference internal" href="citation.html#citation-direct-solution-lbte"><span class="std std-ref">citation</span></a>).</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#how-to-use" id="id1">How to use</a></li>
<li><a class="reference internal" href="#memory-usage" id="id2">Memory usage</a></li>
<li><a class="reference internal" href="#work-load-distribution" id="id3">Work load distribution</a><ul>
<li><a class="reference internal" href="#distribution-of-collision-matrix" id="id4">Distribution of collision matrix</a></li>
<li><a class="reference internal" href="#distribution-of-phonon-phonon-interaction-strengths" id="id5">Distribution of phonon-phonon interaction strengths</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cutoff-parameter-of-pseudo-inversion" id="id6">Cutoff parameter of pseudo inversion</a></li>
<li><a class="reference internal" href="#installation-of-diagonalization-solvers-with-multithreaded-blas" id="id7">Installation of diagonalization solvers with multithreaded BLAS</a><ul>
<li><a class="reference internal" href="#mkl-linked-scipy" id="id8">MKL linked scipy</a></li>
<li><a class="reference internal" href="#openblas-or-mkl-via-lapacke" id="id9">OpenBLAS or MKL via LAPACKE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solver-choice-for-diagonalization" id="id10">Solver choice for diagonalization</a></li>
</ul>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id1">How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>As written in the following sections, this calculation requires large
memory space. When running multiple temperature points, simply the
memory space needed is multiplied by the number of the temperature
points. Therefore it is normally recommended to specify <a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts
option</span></a>. An example to run with the direct solution of
LBTE for <code class="docutils literal notranslate"><span class="pre">example/Si-PBEsol</span></code> is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">sym</span><span class="o">-</span><span class="n">fc</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span>
<span class="o">...</span>

<span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;11 11 11&quot;</span> <span class="o">--</span><span class="n">fc3</span> <span class="o">--</span><span class="n">fc2</span> <span class="o">--</span><span class="n">lbte</span> <span class="o">--</span><span class="n">ts</span><span class="o">=</span><span class="mi">300</span>
<span class="o">...</span>

<span class="o">===================</span> <span class="n">End</span> <span class="n">of</span> <span class="n">collection</span> <span class="n">of</span> <span class="n">collisions</span> <span class="o">===================</span>
<span class="o">-</span> <span class="n">Averaging</span> <span class="n">collision</span> <span class="n">matrix</span> <span class="n">elements</span> <span class="n">by</span> <span class="n">phonon</span> <span class="n">degeneracy</span> <span class="p">[</span><span class="mf">0.031</span><span class="n">s</span><span class="p">]</span>
<span class="o">-</span> <span class="n">Making</span> <span class="n">collision</span> <span class="n">matrix</span> <span class="n">symmetric</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span><span class="p">)</span> <span class="p">[</span><span class="mf">0.000</span><span class="n">s</span><span class="p">]</span>
<span class="o">-----------</span> <span class="n">Thermal</span> <span class="n">conductivity</span> <span class="p">(</span><span class="n">W</span><span class="o">/</span><span class="n">m</span><span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="k">with</span> <span class="n">tetrahedron</span> <span class="n">method</span> <span class="o">-----------</span>
<span class="n">Diagonalizing</span> <span class="n">by</span> <span class="n">lapacke</span> <span class="n">dsyev</span><span class="o">...</span> <span class="p">[</span><span class="mf">0.111</span><span class="n">s</span><span class="p">]</span>
<span class="n">Calculating</span> <span class="n">pseudo</span><span class="o">-</span><span class="n">inv</span> <span class="k">with</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.0e-08</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">)</span> <span class="p">[</span><span class="mf">0.001</span><span class="n">s</span><span class="p">]</span>
<span class="c1">#  T(K)        xx         yy         zz         yz         xz         xy</span>
  <span class="mf">300.0</span>     <span class="mf">111.588</span>    <span class="mf">111.588</span>    <span class="mf">111.588</span>      <span class="mf">0.000</span>      <span class="mf">0.000</span>     <span class="o">-</span><span class="mf">0.000</span>
  <span class="p">(</span><span class="n">RTA</span><span class="p">)</span>     <span class="mf">109.009</span>    <span class="mf">109.009</span>    <span class="mf">109.009</span>      <span class="mf">0.000</span>      <span class="mf">0.000</span>     <span class="o">-</span><span class="mf">0.000</span>
<span class="o">----------------------------------------------------------------------------</span>

<span class="n">Thermal</span> <span class="n">conductivity</span> <span class="ow">and</span> <span class="n">related</span> <span class="n">properties</span> <span class="n">were</span> <span class="n">written</span> <span class="n">into</span>
<span class="s2">&quot;kappa-m111111.hdf5&quot;</span><span class="o">.</span>
<span class="n">Eigenvalues</span> <span class="n">of</span> <span class="n">collision</span> <span class="n">matrix</span> <span class="n">were</span> <span class="n">written</span> <span class="n">into</span> <span class="s2">&quot;coleigs-m111111.hdf5&quot;</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
</div>
<div class="section" id="memory-usage">
<h2><a class="toc-backref" href="#id2">Memory usage</a><a class="headerlink" href="#memory-usage" title="Permalink to this headline">¶</a></h2>
<p>The direct solution of LBTE needs diagonalization of a large collision
matrix, which requires large memory space.  This is the largest
limitation of using this method. The memory size needed for one
collision matrix at a temperature point is <span class="math notranslate nohighlight">\((\text{number of
irreducible grid points} \times \text{number of bands} \times 3)^2\)</span>
for the symmetrized collision matrix.</p>
<p>These collision matrices contain real values and are supposed to be
64bit float symmetric matrices. During the diagonalization of each
collision matrix with LAPACK <code class="docutils literal notranslate"><span class="pre">dsyev</span></code> solver, around 1.2 times more
memory space is consumed in total.</p>
<p>When phono3py runs with <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a> together with
<code class="docutils literal notranslate"><span class="pre">--lbte</span></code> option, estimated memory space needed for storing collision
matrix is presented. An example for <code class="docutils literal notranslate"><span class="pre">example/Si-PBEsol</span></code> is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;40 40 40&quot;</span> <span class="o">--</span><span class="n">wgp</span> <span class="o">--</span><span class="n">lbte</span>
<span class="o">...</span>

<span class="n">Memory</span> <span class="n">requirements</span><span class="p">:</span>
<span class="o">-</span> <span class="n">Piece</span> <span class="n">of</span> <span class="n">collision</span> <span class="n">matrix</span> <span class="n">at</span> <span class="n">each</span> <span class="n">grid</span> <span class="n">point</span><span class="p">,</span> <span class="n">temp</span> <span class="ow">and</span> <span class="n">sigma</span><span class="p">:</span> <span class="mf">0.00</span> <span class="n">Gb</span>
<span class="o">-</span> <span class="n">Full</span> <span class="n">collision</span> <span class="n">matrix</span> <span class="n">at</span> <span class="n">each</span> <span class="n">temp</span> <span class="ow">and</span> <span class="n">sigma</span><span class="p">:</span> <span class="mf">7.15</span> <span class="n">Gb</span>
<span class="o">-</span> <span class="n">Phonons</span><span class="p">:</span> <span class="mf">0.04</span> <span class="n">Gb</span>
<span class="o">-</span> <span class="n">Grid</span> <span class="n">point</span> <span class="n">information</span><span class="p">:</span> <span class="mf">0.00</span> <span class="n">Gb</span>
<span class="o">-</span> <span class="n">Phonon</span> <span class="n">properties</span><span class="p">:</span> <span class="mf">0.14</span> <span class="n">Gb</span>

<span class="o">...</span>
</pre></div>
</div>
<p>With <a class="reference internal" href="command-options.html#stp-option"><span class="std std-ref">–stp option</span></a>, estimated
memory space needed for ph-ph interaction strengths is shown.</p>
</div>
<div class="section" id="work-load-distribution">
<h2><a class="toc-backref" href="#id3">Work load distribution</a><a class="headerlink" href="#work-load-distribution" title="Permalink to this headline">¶</a></h2>
<p>The other difficulty compared with RTA is the workload
distribution. Currently there are two ways to distribute the
calculation: (1) Collision matrix is divided and the pieces are
distributed into computing nodes. (2) Ph-ph interaction strengths at
grid points are distributed into computing nodes. These two can not be
mixed, so one of them has to be chosen. In either case, the
distribution is done simply running a set of phono3py calculations
over grid points and optionally band indices. The data computed on
each computing node are stored in an hdf5 file. Increasing the
calculation size, e.g., larger mesh numbers or larger number of atoms
in the primitive cell, large files are created.</p>
<div class="section" id="distribution-of-collision-matrix">
<span id="distribution-colmat"></span><h3><a class="toc-backref" href="#id4">Distribution of collision matrix</a><a class="headerlink" href="#distribution-of-collision-matrix" title="Permalink to this headline">¶</a></h3>
<p>A full collision matrix is divided into pieces at grid points of
irreducible part of Brillouin zone. Each piece is calculated
independently from the other pieces. After finishing the calculations
of these pieces, the full collision matrix is diagonzalized to obtain
the thermal conductivity.</p>
<p>File size of Each piece of the collision matrix can be
large. Therefore it is recommended to use <a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts option</span></a> to limit the number of temperature points, e.g.,
<code class="docutils literal notranslate"><span class="pre">--ts=&quot;100</span> <span class="pre">200</span> <span class="pre">300</span> <span class="pre">400</span> <span class="pre">500</span></code>, depending on the memory size installed
on each computing node. To write them into files,
<code class="docutils literal notranslate"><span class="pre">--write-collision</span></code> option must be specified, and to read them from
files, <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> option is used. These are similarly used
as <a class="reference internal" href="command-options.html#write-gamma-option"><span class="std std-ref">–write-gamma</span></a> and <a class="reference internal" href="command-options.html#read-gamma-option"><span class="std std-ref">–read-gamma</span></a> options for RTA calculation as shown in
<a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>.
<code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> option collects the pieces and make one full
collision matrix, then starts to diagonalize it. This option requires
one argument to specify an index to read the collision matrix at one
temperature point, e.g., the collision matrix at 200K is read with
<code class="docutils literal notranslate"><span class="pre">--read-collision=1</span></code> for the (pieces of) collision matrices created
with <code class="docutils literal notranslate"><span class="pre">--ts=&quot;100</span> <span class="pre">200</span> <span class="pre">300</span> <span class="pre">400</span> <span class="pre">500&quot;</span></code> (corresponding to 0, 1, 2, 3,
4). The temperature (e.g. 200K) is also read from the file, so it is
unnecessary to specify <a class="reference internal" href="command-options.html#ts-option"><span class="std std-ref">–ts option</span></a> when reading.</p>
<p>The summary of the procedure is as follows:</p>
<ol class="arabic simple">
<li>Running at each grid point with <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option and
saving the piece of the collision matrix to an hdf5 file with
<code class="docutils literal notranslate"><span class="pre">--write-collision</span></code> option. It is probably OK to calculate and
store the pieces of the collision matrices at multiple temperatures
though it depends on memory size of the computer node. This
calculation has to be done at all irreducible grid points.</li>
<li>Collecting and creating all necessary pieces of the collision
matrix with <code class="docutils literal notranslate"><span class="pre">--read-collision=num</span></code> (<code class="docutils literal notranslate"><span class="pre">num</span></code>: index of
temperature). By this one full collision matrix at the selected
temperature is created and then diagonalized. An option <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">num</span></code>
may be used together with <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> to distinguish the
file names of the results at different temperatures.</li>
</ol>
<p>Examples of command options are shown below using <code class="docutils literal notranslate"><span class="pre">Si-PBE</span></code> example.
Irreducible grid point indices are obtained by <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;19 19 19&quot;</span> <span class="o">--</span><span class="n">lbte</span> <span class="o">--</span><span class="n">wgp</span>
</pre></div>
</div>
<p>and the information is given in <code class="docutils literal notranslate"><span class="pre">ir_grid_points.yaml</span></code>. For
distribution of collision matrix calculation (see also <a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;19 19 19&quot;</span> <span class="o">--</span><span class="n">fc3</span> <span class="o">--</span><span class="n">fc2</span> <span class="o">--</span><span class="n">lbte</span> <span class="o">--</span><span class="n">ts</span><span class="o">=</span><span class="mi">300</span> <span class="o">--</span><span class="n">write</span><span class="o">-</span><span class="n">collision</span> <span class="o">--</span><span class="n">gp</span><span class="o">=</span><span class="s2">&quot;grid_point_numbers...&quot;</span>
</pre></div>
</div>
<p>To collect distributed pieces of the collision matrix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;19 19 19&quot;</span> <span class="o">--</span><span class="n">fc3</span> <span class="o">--</span><span class="n">fc2</span> <span class="o">--</span><span class="n">lbte</span> <span class="o">--</span><span class="n">ts</span><span class="o">=</span><span class="mi">300</span> <span class="o">--</span><span class="n">read</span><span class="o">-</span><span class="n">collision</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="distribution-of-phonon-phonon-interaction-strengths">
<h3><a class="toc-backref" href="#id5">Distribution of phonon-phonon interaction strengths</a><a class="headerlink" href="#distribution-of-phonon-phonon-interaction-strengths" title="Permalink to this headline">¶</a></h3>
<p>The distribution of pieces of collision matrix is straightforward and
is recommended to use if the number of temperature points is
small. However increasing data file size, network communication
becomes to require long time to send the files from a master node to
computation nodes. In this case, the distribution over ph-ph
interaction strengths can be another choice. Since, without using
<a class="reference internal" href="command-options.html#full-pp-option"><span class="std std-ref">–full-pp option</span></a>, the tetrahedron method or
smearing approach with <a class="reference internal" href="command-options.html#sigma-cutoff-option"><span class="std std-ref">–sigma-cutoff option</span></a> results in the sparse ph-ph interaction
strength data array, i.e., most of the elements are zero, the data
size can be reduced by only storing non-zero elements. Not like the
collision matrix, the ph-ph interaction strengths in phono3py are
independent from temperature though it is not the case if the force
constants provided are temperature dependent. Once
stored, they are used to create the collision matrices at
temperatures. Using <code class="docutils literal notranslate"><span class="pre">--write-pp</span></code> and <code class="docutils literal notranslate"><span class="pre">--read-pp</span></code>, they are written
into and read from hdf5 files at grid points.</p>
<p>It is also recommended to use <a class="reference internal" href="command-options.html#write-phonon-option"><span class="std std-ref">–write-phonon option</span></a> and <a class="reference internal" href="command-options.html#read-phonon-option"><span class="std std-ref">–read-phonon option</span></a> to use identical phonon eigenvectors among the
distributed nodes.</p>
<p>The summary of the procedure is as follows:</p>
<ol class="arabic simple">
<li>Running at each grid point with <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option and storing the ph-ph interaction
strengths to an hdf5 file with <code class="docutils literal notranslate"><span class="pre">--write-pp</span></code> option. This calculation
has to be done at all irreducible grid points.</li>
<li>Running with <code class="docutils literal notranslate"><span class="pre">--read-pp</span></code> option and without <a class="reference internal" href="command-options.html#gp-option"><span class="std std-ref">–gp</span></a> (or
<a class="reference internal" href="command-options.html#ga-option"><span class="std std-ref">–ga</span></a>) option. By this one full collision matrix at the
selected temperature is created and then diagonalized. An option
<code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">num</span></code> may be used together with <code class="docutils literal notranslate"><span class="pre">--read-collision</span></code> to
distinguish the file names of the results at different
temperatures.</li>
</ol>
<p>Examples of command options are shown below using <code class="docutils literal notranslate"><span class="pre">Si-PBE</span></code> example.
Irreducible grid point indices are obtained by <a class="reference internal" href="command-options.html#wgp-option"><span class="std std-ref">–wgp option</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;19 19 19&quot;</span> <span class="o">--</span><span class="n">lbte</span> <span class="o">--</span><span class="n">wgp</span>
</pre></div>
</div>
<p>and the grid point information is provided in
<code class="docutils literal notranslate"><span class="pre">ir_grid_points.yaml</span></code>. All phonons on mesh grid points are saved
by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;19 19 19&quot;</span> <span class="o">--</span><span class="n">fc2</span> <span class="o">--</span><span class="n">write</span><span class="o">-</span><span class="n">phonon</span>
</pre></div>
</div>
<p>For distribution of ph-ph interaction strength calculation (see also
<a class="reference internal" href="workload-distribution.html#workload-distribution"><span class="std std-ref">Workload distribution</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;19 19 19&quot;</span> <span class="o">--</span><span class="n">fc3</span> <span class="o">--</span><span class="n">fc2</span> <span class="o">--</span><span class="n">lbte</span> <span class="o">--</span><span class="n">ts</span><span class="o">=</span><span class="mi">300</span> <span class="o">--</span><span class="n">write</span><span class="o">-</span><span class="n">pp</span> <span class="o">--</span><span class="n">gp</span><span class="o">=</span><span class="s2">&quot;grid_point_numbers...&quot;</span> <span class="o">--</span><span class="n">read</span><span class="o">-</span><span class="n">phonon</span>
</pre></div>
</div>
<p>Here one temperature has to be specified but any one of temperatures
is OK since ph-ph interaction strength computed here is assumed to be
temperature independent. Then the computed ph-ph interaction strengths
are read and used to compute collision matrix and lattice thermal
conductivity at a temperature by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;19 19 19&quot;</span> <span class="o">--</span><span class="n">fc3</span> <span class="o">--</span><span class="n">fc2</span> <span class="o">--</span><span class="n">lbte</span> <span class="o">--</span><span class="n">ts</span><span class="o">=</span><span class="mi">300</span> <span class="o">--</span><span class="n">read</span><span class="o">-</span><span class="n">pp</span> <span class="o">--</span><span class="n">read</span><span class="o">-</span><span class="n">phonon</span>
</pre></div>
</div>
<p>This last command is repeated at different temperatures to obtain the
properties at multiple temperatures.</p>
</div>
</div>
<div class="section" id="cutoff-parameter-of-pseudo-inversion">
<span id="diagonzalization-solver"></span><h2><a class="toc-backref" href="#id6">Cutoff parameter of pseudo inversion</a><a class="headerlink" href="#cutoff-parameter-of-pseudo-inversion" title="Permalink to this headline">¶</a></h2>
<p>To achieve a pseudo inversion, a cutoff parameter is used to find null
space, i.e., to select the nearly zero eigenvalues. The default cutoff
value is <code class="docutils literal notranslate"><span class="pre">1e-8</span></code>, and this hopefully works in many cases. But if a
collision matrix is numerically not very accurate, we may have to
carefully choose the value by <code class="docutils literal notranslate"><span class="pre">--pinv-cutoff</span></code> option. It is safer to
plot the absolute values of eigenvalues in log scale to see if there
is clear gap between non-zero eigenvalue and nearly-zero eigenvalues.
After running the direct solution of LBTE, <code class="docutils literal notranslate"><span class="pre">coleigs-mxxx.hdf5</span></code> is
created. This contains the eigenvalues of the collision matrix (either
symmetrized or non-symmetrized). The eigenvalues are plotted using
<code class="docutils literal notranslate"><span class="pre">phono3py-coleigplot</span></code> in the phono3py package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phono3py</span><span class="o">-</span><span class="n">coleigplot</span> <span class="n">coleigs</span><span class="o">-</span><span class="n">mxxx</span><span class="o">.</span><span class="n">hdf5</span>
</pre></div>
</div>
<p>It is assumed that only one set of eigenvalues at a temperature point
is contained.</p>
<div class="figure" id="coleigplot">
<a class="reference internal image-reference" href="_images/Si-coleigplot.png"><img alt="_images/Si-coleigplot.png" src="_images/Si-coleigplot.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-text">Eigenvalues are plotted in log scale (Si-PBEsol exmaple with
15x15x15 mesh). The number in x-axis is just the index where each
eigenvalue is stored. Normally the eigenvalues are stored ascending
order. The bule points show the positive values, and
the red points show the negative values as positive values
(absolute values) to be able to plot in log scale. In this plot, we
can see the gap between <span class="math notranslate nohighlight">\(10^{-4}\)</span> and <span class="math notranslate nohighlight">\(10^{-16}\)</span>, which
is a good sign. The values whose absolute values are smaller than
<span class="math notranslate nohighlight">\(10^{-8}\)</span> are treated as 0 and those solutions are considered
as null spaces.</span></p>
</div>
</div>
<div class="section" id="installation-of-diagonalization-solvers-with-multithreaded-blas">
<h2><a class="toc-backref" href="#id7">Installation of diagonalization solvers with multithreaded BLAS</a><a class="headerlink" href="#installation-of-diagonalization-solvers-with-multithreaded-blas" title="Permalink to this headline">¶</a></h2>
<p>Multithreaded BLAS is recommended to use for the calculation of the
direct solution of LBTE since the diagonalization of the collision
matrix is computationally demanding. A few examples of how to install
multithreded BLAS libraries are presented below.</p>
<div class="section" id="mkl-linked-scipy">
<h3><a class="toc-backref" href="#id8">MKL linked scipy</a><a class="headerlink" href="#mkl-linked-scipy" title="Permalink to this headline">¶</a></h3>
<p>Scipy (also numpy) has an interface to LAPACK dsyev
(<code class="docutils literal notranslate"><span class="pre">scipy.linalg.lapack.dsyev</span></code>). An MKL LAPACK linked scipy (also
numpy) gives very good computing performance and is easily obtained
using the anaconda package manager. In this choice, usual installation
of LAPACKE is necessary for running <code class="docutils literal notranslate"><span class="pre">dgesvd</span></code> and <code class="docutils literal notranslate"><span class="pre">zheev</span></code>. When
using anaconda, installing OpenBLAS is the easiest way to do. See
<a class="reference internal" href="install.html#install-openblas-lapacke"><span class="std std-ref">OpenBLAS provided by conda (with multithread BLAS)</span></a></p>
</div>
<div class="section" id="openblas-or-mkl-via-lapacke">
<h3><a class="toc-backref" href="#id9">OpenBLAS or MKL via LAPACKE</a><a class="headerlink" href="#openblas-or-mkl-via-lapacke" title="Permalink to this headline">¶</a></h3>
<p>Using LAPACKE via python C-API is implemented. By this, phono3py can
use LAPACK dsyev. This uses smaller memory space than using MKL linked
scipy. Practically there are two choices, OpenBLAS and MKL. For MKL,
proper installatin of the MKL package is necessary. The MKL
library installed obtained from anaconda can not be used.</p>
<div class="section" id="openblas">
<h4>OpenBLAS<a class="headerlink" href="#openblas" title="Permalink to this headline">¶</a></h4>
<p>Use of OpenBLAS is an easy choice if the anaconda package is used.
See <a class="reference internal" href="install.html#install-openblas-lapacke"><span class="std std-ref">OpenBLAS provided by conda (with multithread BLAS)</span></a>.</p>
</div>
<div class="section" id="mkl">
<h4>MKL<a class="headerlink" href="#mkl" title="Permalink to this headline">¶</a></h4>
<p>The BLAS multithread performance may be better in that in MKL. Using
MKL-LAPACK via MKL-LAPACKE via python C-API is also implemented if the
link is succeeded. See <a class="reference internal" href="install.html#install-mkl-lapacke"><span class="std std-ref">MKL LAPACKE (with multithread BLAS)</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="solver-choice-for-diagonalization">
<h2><a class="toc-backref" href="#id10">Solver choice for diagonalization</a><a class="headerlink" href="#solver-choice-for-diagonalization" title="Permalink to this headline">¶</a></h2>
<p>For larger systems, diagonalization of collision matrix takes longest
time and requires large memory space. Phono3py relies on LAPACK for
the diagonalization and so the performance is dependent on the choice
of the diagonalization solver.</p>
<p>Using multithreaded BLAS with many-core computing node, computing time
may be well reduced and the calculation can finish in a realistic
time.  Currently scipy, numpy and LAPACKE can be used as the LAPACK
wrapper in phono3py. Scipy and numpy distributed by anaconda are MKL
linked, therefore MKL multithread BLAS is used through
them. Multithreaded OpenBLAS is installed by conda and can be used via
LAPACKE in phono3py. MKL LAPACK and BLAS are also able to be used via
LAPACKE in phono3py with appropriate setting in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">--pinv-solver=[number]</span></code>, one of the following solver is
chosen:</p>
<ol class="arabic simple">
<li>Lapacke <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>: Smaller memory consumption than <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>, but
slower. This is the default solver when MKL LAPACKE is integrated or
scipy is not installed.</li>
<li>Lapacke <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>: Larger memory consumption than <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>, but
faster. This is not recommended because sometimes a wrong result is
obtained.</li>
<li>Numpy’s <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code> (<code class="docutils literal notranslate"><span class="pre">linalg.eigh</span></code>). This is not recommended
because sometimes a wrong result is obtained.</li>
<li>Scipy’s <code class="docutils literal notranslate"><span class="pre">dsyev</span></code>: This is the default solver when scipy is
installed and MKL LAPACKE is not integrated.</li>
<li>Scipy’s <code class="docutils literal notranslate"><span class="pre">dsyevd</span></code>. This is not recommended because sometimes a
wrong result is obtained.</li>
</ol>
<p>The solver choices other than <code class="docutils literal notranslate"><span class="pre">--pinv-solver=1</span></code> and
<code class="docutils literal notranslate"><span class="pre">--pinv-solver=4</span></code> are dangerous and not recommend. They exist just
for the tests.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/direct-solution.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2015, Atsushi Togo.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>